---
- name: Install OS-specific packages
  hosts: localhost
  become: yes

  tasks:
    - name: Execute Install Missing Dependencies
      shell: bash scripts/debian_install.sh
      when: ansible_pkg_mgr == 'apt'
      become: yes

    - name: Install OS-specific packages on Debian-based systems (Ubuntu)
      apt:
        name: ['zsh', 'tmux', 'fzf', 'lazygit', 'bat', 'exa', 'fd-find', 'ripgrep', 'ansible', 'fastfetch', 'bpytop']
        state: present
      with_items:
        - zsh
        - tmux
        - fzf
        - bat
        - exa
        - fd-find
        - ripgrep
        - ansible
        - bpytop
        - alacritty
        - wget
      when: ansible_pkg_mgr == 'apt'
      become: yes

    - name: Install OS-specific packages on Red Hat-based systems (Amazon Linux)
      yum:
        name: ['zsh', 'tmux', 'fzf', 'lazygit', 'bat', 'exa', 'fd-find', 'ripgrep', 'ansible', 'lsd', 'fastfetch', 'bpytop']
        state: present
      with_items:
        - zsh
        - tmux
        - fzf
        - lazygit
        - bat
        - exa
        - fd-find
        - ripgrep
        - ansible
        - lsd
        - bpytop
        - alacritty
        - wget
      when: ansible_pkg_mgr == 'yum'
      become: yes

    - name: Install OS-specific packages on Arch Linux
      pacman:
        name: ['neovim', 'zsh', 'fzf', 'tmux', 'bpytop', 'lsd', 'fastfetch', 'ansible', 'bat', 'exa', 'fd', 'ripgrep', 'lazygit']
        state: present
      with_items:
        - neovim
        - zsh
        - fzf
        - tmux
        - bpytop
        - lsd
        - ansible
        - bat
        - exa
        - fd
        - ripgrep
        - lazygit
        - alacritty
        - wget
      when: ansible_pkg_mgr == 'pacman'

    - name: Clone Yay repository from AUR
      git:
        repo: https://aur.archlinux.org/yay.git
        dest: /tmp/yay
        version: master
      when: ansible_pkg_mgr == 'pacman'

    - name: Build and install Yay
      shell: "cd /tmp/yay && makepkg -si"
      when: ansible_pkg_mgr == 'pacman'

    - name: Install OS-specific packages on macOS using Homebrew
      homebrew:
        name: ['neovim', 'zsh', 'fzf', 'tmux', 'bpytop', 'lsd', 'fastfetch', 'ansible', 'bat', 'exa', 'fd', 'ripgrep', 'lazygit']
      with_items:
        - neovim
        - zsh
        - fzf
        - tmux
        - bpytop
        - lsd
        - ansible
        - bat
        - exa
        - fd
        - ripgrep
        - lazygit
        - alacritty
        - wget
      when: ansible_pkg_mgr == 'homebrew'

    - name: Installing Oh-My-Zsh
      shell: >
        echo "Installing Oh-My-Zsh..."
        sh -c "$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)"

    - name: Downloading and installing Meslo Nerd Font
      shell: >
        echo "Downloading and installing Meslo Nerd Font..."
        FONT_PATH="$HOME/.local/share/fonts"
        FONT_NAME="MesloLGS NF Regular.ttf"
        FONT_URL="https://github.com/romkatv/dotfiles-public/raw/master/.local/share/fonts/NerdFonts/${FONT_NAME// /%20}"
        mkdir -p "${FONT_PATH}"
        wget -O "${FONT_PATH}/${FONT_NAME}" "${FONT_URL}"

    - name: Installing additional fonts from 'fonts' folder
      shell: >
        echo "Installing additional fonts from 'fonts' folder..."
        cp fonts/* "${HOME}/.local/share/fonts/"

    - name: Configuring Zsh plugins
      shell: >
        echo "Configuring Zsh plugins..."
        ZSH_CUSTOM=${ZSH_CUSTOM:-~/.oh-my-zsh/custom}

        git clone --depth 1 https://github.com/marlonrichert/zsh-autocomplete.git "${ZSH_CUSTOM}/plugins/zsh-autocomplete"
        git clone https://github.com/zsh-users/zsh-autosuggestions "${ZSH_CUSTOM}/plugins/zsh-autosuggestions"
        git clone https://github.com/zsh-users/zsh-syntax-highlighting.git "${ZSH_CUSTOM}/plugins/zsh-syntax-highlighting"
        git clone --depth=1 https://github.com/romkatv/powerlevel10k.git "${ZSH_CUSTOM}/themes/powerlevel10k"

    - name: Install Optional Packages with pacman
      pacman:
        name:
          - firefox
          - nitrogen
          - neofetch
          - wget
          - git
          - lxappearance

